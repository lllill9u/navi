$(document).ready(function(){
	function getCsrfToken(){
		return document.querySelector('meta[name="_csrf"]').getAttribute('content');
	}
	function getCsrfHeader(){
		return document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
	}
	$(modifyForm).on("submit",function(e){
		e.preventDefault();
		$(proDesc).val(viewEdit.innerHTML)
		console.log($(proDesc).val())
		let data={};
		let formData= new FormData(modifyForm);
		for(let n of formData.keys()){
			data[n]=formData.get(n)
		}
		let body=JSON.stringify(data);
	    formData["proDesc"] = viewEdit.innerHTML;
		console.log(getCsrfToken())
		console.log(getCsrfHeader())
		fetch(modifyForm.action,{
			method:"PUT",
			headers:{
				"accept":"application/json",
				"content-type":"application/json",
				[getCsrfHeader()]: getCsrfToken()
			},body:body
		}).then(resp=>{
			if(resp.ok){
				return resp.json()
			}else{
				throw new Error("상태코드 "+resp.status)
			}
		}).then(jsonObj=>{
			console.log(jsonObj)
			if(jsonObj.msg=='ok'){
				updateResult.innerHTML="수정이 완료되었습니다."
			}else{
				updateResult.innerHTML="수정에 실패했습니다.."
			}
		})
	})
	$(deleteForm).on("submit", function(e){
		e.preventDefault();
		let data={};
		let formData= new FormData(deleteForm);
		for(let n of formData.keys()){
			data[n]=formData.get(n)
		}
		let body=JSON.stringify(data);
		fetch(deleteForm.action,{
			method:"DELETE",
			headers:{
				"accept":"application/json",
				"content-type":"application/json",
				[getCsrfHeader()]: getCsrfToken()
			},body:body
		}).then(resp=>{
			if(resp.ok){
				return resp.json()
			}else{
				throw new Error("상태코드 "+resp.status)
			}
		}).then(jsonObj=>{
			console.log(jsonObj)
			if(jsonObj.msg=='ok'){
				deleteResult.innerHTML="삭제가 완료되었습니다."
			}else{
				deleteResult.innerHTML="삭제에 실패했습니다."
			}
		})
	})
})

